#!/bin/bash

# scripts/dot
# Main entry point for dotfiles management commands.

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOTFILES_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

usage() {
    local exit_code="${1:-1}"
    echo "Usage: dot <command> [arguments]"
    echo ""
    echo "Commands:"
    echo "  add <file> [cat]    Add a new dotfile to management"
    echo "  mv <old> <new>      Rename a managed dotfile"
    echo "  update             Update system package list"
    echo "  setup [entry]      Run the setup script (link files)"
    echo "  help               Show this help message"
    exit "$exit_code"
}

if [ "$#" -lt 1 ]; then
    usage
fi

COMMAND="$1"
shift

case "$COMMAND" in
    add)
        "$SCRIPT_DIR/cmds/add.sh" "$@"
        ;;
    mv)
        "$SCRIPT_DIR/cmds/mv.sh" "$@"
        ;;
    update)
        "$SCRIPT_DIR/cmds/update.sh" "$@"
        ;;
    setup)
        "$DOTFILES_DIR/setup.sh" "$@"
        ;;
    help|--help|-h)
        usage 0
        ;;
    *)
        echo "Error: Unknown command '$COMMAND'"
        usage
        ;;
esac
